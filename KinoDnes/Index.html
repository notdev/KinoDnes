<!DOCTYPE html>
<html>
<head>
    <title>Kino Dnes</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.10/angular.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="Static/normalize.css">
    <link rel="stylesheet" href="Static/skeleton.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <style type="text/css">
        body { background: url(Static/bg.png) }

        h5 { text-align: center; }

        .movie {
            border-bottom: 1px dotted #666;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .movie a {
            color: black;
            text-decoration: none;
        }

        .movie a:hover { background: #CCC; }

        .shit { color: #8592A3 }

        .prumer { color: #3F92C5 }

        .dobre { color: #8E2800; }

        .loadersmall {
            -moz-animation: spin 1s linear infinite;
            -ms-animation: spin 1s linear infinite;
            -ms-border-radius: 50%;
            -o-animation: spin 1s linear infinite;
            -webkit-animation: spin 1s linear infinite;
            animation: spin 1s linear infinite;
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #555;
            height: 50px;
            left: 50%;
            margin-top: 10px;
            position: absolute;
            text-align: center;
            top: 50%;
            width: 50px;
        }

        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }

            100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div ng-app="kino" ng-controller="kinoCtrl" class="container">
        <div class="loadersmall" ng-show="loading"></div>
        <div ng-repeat="listing in cinemaListings" class="row">
            <div class="column" style="margin: 3% 0">
                <h5>
                    <a href="http://www.google.com/search?q={{listing.CinemaName}}&btnI">{{listing.CinemaName}}</a>
                </h5><hr class="nadpis">
                <div class="movie" ng-repeat="movie in listing.Movies">
                    <a href="{{movie.Url}}">{{movie.MovieName}}</a>,
                    <span ng-if="0 < movie.Rating && movie.Rating < 30" class="shit"> {{movie.Rating}} %</span>
                    <span ng-if="30 <= movie.Rating && movie.Rating < 70" class="prumer"> {{movie.Rating}} %</span>
                    <span ng-if="70 <= movie.Rating" class="dobre"> {{movie.Rating}} %</span><br>
                    <code ng-repeat="time in movie.Times">{{time}}</code><span>{{movie.Flags.join(', ')}}</span>
                </div>
            </div>
        </div>
        <div id="districtButtons" style="display: none;">
            <div>
                <button ng-click="selectCity('Praha')">Praha</button>
            </div>
            <div>
                <button ng-click="selectCity('Bratislava')">Bratislava</button>
            </div>
            <div>
                <button ng-click="selectCity('Brno')">Brno</button>
            </div>
            <div>
                <button ng-click="selectCity('Ostrava')">Ostrava</button>
            </div>
            <div ng-repeat="city in cityList">
                <button ng-click="selectCity(city)">{{city}}</button>
            </div>
        </div>
        <div id="noMoviesMessage" style="display: none;">
            <div class="container" style="margin: 0 auto;">
                <h5>Dnes jiz v kině nic nedávají, zkuste to znovu zítra.</h5>
            </div>
        </div>
        <script>
        var app = angular.module('kino', []);
        app.controller('kinoCtrl',
            function($scope, $http) {
                $scope.loading = true;

                $scope.selectCity = function(cityName) {
                    location.href = "/" + cityName;
                };

                function displayCityList() {
                    $http.get("/api/kino/Cities")
                        .then(function(response) {
                            $scope.cityList = response.data;
                            document.getElementById("districtButtons").style.display = "";
                            $scope.loading = false;
                        });
                }

                var district = location.pathname.replace("/", "");
                if (!district) {
                    displayCityList();
                } else {
                    $http.get("/api/kino/" + district)
                        .then(function(response) {
                            if (response.data.length === 0) {
                                document.getElementById("noMoviesMessage").style.display = "";
                            };
                            $scope.cinemaListings = response.data;
                            $scope.loading = false;
                        });
                }
            });
        </script>
    </div>
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] ||
            function() {
                (i[r].q = i[r].q || []).push(arguments);
            }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-82408384-1', 'auto');
    ga('send', 'pageview');
    </script>
</body>
</html>